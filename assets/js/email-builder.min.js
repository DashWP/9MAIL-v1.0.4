jQuery(document).ready(function(e){"use strict";var t;localStorage.removeItem("emtmplCopy"),localStorage.removeItem("emtmplCopyRow"),window.styleSection="style",window.contentSection="content",window.viWecEditorArea="#emtmpl-email-editor-content",window.viWecChange=!0,window.viWecDefaultExist=!1,window.viWecFontWeightOptions=[{id:300,text:300},{id:400,text:400},{id:500,text:500},{id:600,text:600},{id:700,text:700},{id:800,text:800},{id:900,text:900}],window.viWecAlignmentOptions=[{value:"left",title:"Left",icon:"dashicons dashicons-editor-alignleft",checked:!0},{value:"center",title:"Center",icon:"dashicons dashicons-editor-aligncenter",checked:!1},{value:"right",title:"Right",icon:"dashicons dashicons-editor-alignright",checked:!1}],window.viWecFontFamilyOptions=[{id:"'andale mono', monospace",text:"Andale Mono"},{id:"arial, helvetica, sans-serif",text:"Arial"},{id:"'arial black', sans-serif",text:"Arial Black"},{id:"'book antiqua', palatino, serif",text:"Book Antiqua"},{id:"'comic sans ms', sans-serif",text:"Comic Sans MS"},{id:"'courier new', courier, monospace",text:"Courier New"},{id:"georgia, palatino, serif",text:"Georgia"},{id:"helvetica, arial, sans-serif",text:"Helvetica"},{id:"impact, sans-serif",text:"Impact"},{id:"symbol",text:"Symbol"},{id:"tahoma, arial, helvetica, sans-serif",text:"Tahoma"},{id:"terminal, monaco, monospace",text:"Terminal"},{id:"'times new roman', times, serif",text:"Times New Roman"},{id:"'trebuchet ms', geneva, sans-serif",text:"Trebuchet MS"},{id:"verdana, geneva, sans-serif",text:"Verdana"},{id:"webdings",text:"Webdings"},{id:"wingdings, 'zapf dingbats'",text:"Wingdings"},],window.viWecMapObj=viWecParams.shortcode_for_replace,window.viWecShortcodeListValue=[],void 0===window.ViWec&&(window.ViWec={}),t={},window.viWecTmpl=function e(l,n){var o=/^[-a-zA-Z0-9]+$/.test(l)?t[l]=t[l]||e(document.getElementById(l).innerHTML):Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+l.replace(/[\r\t\n]/g," ").split("{%").join("	").replace(/((^|%})[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%}/g,"',$1,'").split("	").join("');").split("%}").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return n?o(n):o},window.viWecNoticeBox=(t,l,n=3e3)=>{l=l||"white";let o=e("#emtmpl-notice-box");o.text(t).css({color:l,bottom:0}),setTimeout(function(){o.css({bottom:"-50px"})},n)},e.fn.handleRow=function(){if(0===this.find(".emtmpl-layout-handle-outer").length){let t=viWecTmpl("emtmpl-input-handle-outer",{});t=e(t),this.append(t),e(this).find('.emtmpl-element[data-type="html/recover_content"]').length&&t.css("display","none")}return this.on("click",".emtmpl-delete-row-btn",()=>{if(e(this).find('.emtmpl-element[data-type="html/recover_content"]').length){alert("Cannot remove row contain default content element");return}this.remove(),ViWec.Builder.clearTab(),ViWec.Builder.activeTab("components")}),this.on("click",".emtmpl-duplicate-row-btn",()=>{if(e(this).find('.emtmpl-element[data-type="html/recover_content"]').length){alert("Cannot duplicate row contain default content element");return}let t=this.clone();t.find(".emtmpl-column-sortable").columnSortAble(),t.handleRow().handleColumn(),this.after(t)}),this.on("click",".emtmpl-edit-outer-row-btn",()=>{ViWec.Builder.removeFocus(),this.addClass("emtmpl-block-focus");let e=this.find(".emtmpl-layout-row"),t=this.find(".emtmpl-template-block");if(ViWec.Builder.selectedEl=e.length?e:t,ViWec.Builder.loadLayoutControl(),t.length){let l=t.attr("data-block");l&&window.open(`post.php?post=${l}&action=edit`)}}),this.on("click",".emtmpl-copy-row-btn",()=>{if(e(this).find('.emtmpl-element[data-type="html/recover_content"]').length){alert("Cannot copy row contain default content element");return}let t=e(this);t=t.prop("outerHTML"),localStorage.setItem("emtmplCopyRow",t),viWecNoticeBox("Copied")}),this.on("click",".emtmpl-paste-row-btn",function(){let t=localStorage.getItem("emtmplCopyRow");t&&((t=e(t)).find(".emtmpl-column-sortable").columnSortAble(),t.handleRow().handleColumn(),e(this).closest(".emtmpl-block").after(t))}),this},e.fn.handleElement=function(){let t="block",l="";"html/recover_content"===e(this).attr("data-type")&&"default"===e(".emtmpl-set-email-type").val()&&(t="none"),"html/recover_content"!==e(this).attr("data-type")&&(l='<span class="dashicons dashicons-admin-page emtmpl-duplicate-element-btn" title="Duplicate"> </span>'),this.append(`<div class="emtmpl-element-handle" >
                        <div class="emtmpl-element-handle-inner" style="display: ${t}">
                            <span class="dashicons dashicons-welcome-add-page emtmpl-copy-element-btn" title="Copy"> </span>
                            ${l}
                            <span class="dashicons dashicons-no-alt emtmpl-delete-element-btn" title="Delete"> </span>
                        </div>
                    </div>`)},e.fn.columnSortAble=function(){e(this).sortable({cursor:"move",cursorAt:{left:40,top:18},placeholder:"emtmpl-placeholder",connectWith:".emtmpl-column-sortable",thisColumn:"",accept:".emtmpl-content-draggable",start:function(e,t){t.helper.addClass("emtmpl-is-dragging"),this.thisColumn=t.helper.closest(".emtmpl-column")},stop:function(e,t){let l=t.item.get(0).style;l.position=l.top=l.left=l.right=l.bottom=l.height=l.width="",t.item.removeClass("emtmpl-is-dragging"),t.item.offsetParent().find(".emtmpl-element").length&&t.item.offsetParent().removeClass("emtmpl-column-placeholder"),this.thisColumn.find(".emtmpl-element").length||this.thisColumn.addClass("emtmpl-column-placeholder"),t.item.click(),viWecChange=!0}})},e.fn.handleColumn=function(){return this.find('.emtmpl-element[data-type="html/recover_content"]').length&&(this.find(".emtmpl-column-paste").hide(),this.find(".emtmpl-column-edit").hide()),this.on("click",e=>{(this.hasClass("emtmpl-column-placeholder")||this.find(".emtmpl-column-placeholder").length)&&(ViWec.Builder.removeFocus(),ViWec.Builder.selectedEl=this.find(".emtmpl-column-sortable").addClass("emtmpl-block-focus"),ViWec.Builder.loadLayoutControl("editColumn"))}),this.on("click",".emtmpl-column-edit",()=>{ViWec.Builder.removeFocus(),ViWec.Builder.selectedEl=this.find(".emtmpl-column-sortable").addClass("emtmpl-block-focus"),ViWec.Builder.loadLayoutControl("editColumn")}),this.on("click",".emtmpl-column-paste",function(){let t=localStorage.getItem("emtmplCopy");t&&(t=e(t),e(this).closest(".emtmpl-column").find(".emtmpl-column-sortable").append(t))}),this},ViWec.viWecReplaceShortcode=e=>{if(!e||"string"!=typeof e)return e;var t=RegExp(Object.keys(viWecMapObj).join("|"),"gm");return e=e.replace(t,function(e){return viWecMapObj[e]})},ViWec.Components={_categories:{},_components:{baseProp:{}},init(){for(let e of[{id:"sample",name:"Sample",page:"template"},{id:"layout",name:"Layout"},{id:"content",name:"Basic content"},])e.page&&"template"===e.page&&"emtmpl"!==window.pagenow||this.registerCategory(e.id,e.name)},registerCategory(e,t){this._categories[e]||(this._categories[e]={name:t,elements:[]})},get:function(e){return this._components[e]},add(e){let t=e.category||"content";if(this._categories[t]&&this._categories[t].elements.push(e.type),e.inheritProp){let l=[];for(let n of e.inheritProp)this._components.baseProp[n]&&(l=[...l,...this._components.baseProp[n].properties]);e.properties||(e.properties=[]),e.properties=[...e.properties,...l]}this._components[e.type]=e},addBaseProp(e){this._components.baseProp[e.type]=e},render:function(t){let l=this._components[t],n,o=e("#emtmpl-attributes-list");if(!l)return;var i=function(e,t,l){return t.input.on("propertyChange",function(n,o,i){viWecChange=!0;let a=ViWec.viWecReplaceShortcode(o);if(t.outputValue&&(o=t.outputValue),t.htmlAttr)switch(!0){case["style","childStyle"].indexOf(t.htmlAttr)>-1:let m=t.unit?t.unit:"";l=ViWec.StyleManager.setStyle(l,t.key,o,m);break;case"innerHTML"===t.htmlAttr:if(t.renderShortcode){let s=l.clone(),r=(l=l.html(o).hide()).parent().find(".emtmpl-text-view");0===r.length?(s=s.removeClass().html(a).addClass("emtmpl-text-view"),l.after(s)):r.html(a)}else l.html(o);break;case"data-block"===t.htmlAttr:let c=viWecParams.templateBlocks.find(e=>+e.id==+o).data;if(c){let p=ViWec.renderRows(c.rows,!1);l.html(p),l=l.attr(t.htmlAttr,o)}break;default:l=l.attr(t.htmlAttr,o)}return"function"==typeof e.onChange&&(l=e.onChange(l,t,o,i)),"function"==typeof t.onChange&&(l=t.onChange(l,o,a,i,e,t)),l})};let a="";for(let m in l.name&&o.append(`<div id="emtmpl-component-name">Component: ${l.name}</div>`),l.properties){let s=l.properties[m],r=ViWec.Builder.selectedEl;if((!r.find('.emtmpl-element[data-type="html/recover_content"]').length||"cols_header"!==s.key&&"cols"!==s.key)&&!1!==s.visible&&(!s.target||r.find(s.target).length)&&(s.target&&r.find(s.target).length&&(r=r.find(s.target)),s.data?(s.data.key=s.key,s.name&&(s.data.header=s.name)):(s.data={key:s.key},s.name&&(s.data.header=s.name)),s.inputType)){if(s.inputType.hasOwnProperty("init")&&(s.input=s.inputType.init(s.data)),s.init)s.inputType.setValue(s.init(r.get(0)));else if(s.htmlAttr){let c;(c="style"===s.htmlAttr?ViWec.StyleManager.getStyle(r,s):"childStyle"===s.htmlAttr?ViWec.StyleManager.getStyle(r,s):"innerHTML"===s.htmlAttr?r.html():r.attr(s.htmlAttr))||!s.default||(c=s.default),c&&s.inputType.setValue(c)}if(s.input&&i(l,s,r),n=s.section?s.section:""){if(0===o.find(`.emtmpl-${n}`).length&&o.append(`<div class="emtmpl-${n} vi-ui accordion styled fluid">
                                                <div class="title active">
                                                    <i class="dropdown icon"></i>
                                                    ${n.replace(/^./,n[0].toUpperCase())}
                                                </div>
                                                <div class="content active ${n}-properties">
                                            </div></div>`),s.inputType===SectionInput)o.find(`.emtmpl-${n} .${n}-properties`).append(viWecTmpl("emtmpl-input-sectioninput",s.data)),a=s.key?s.key:a;else if(s.label)o.find(`.emtmpl-${n} .${a}`).append(`<label class="emtmpl-group-name" for="input-model">${s.label}</label>`);else if(!s.hidden){let p=e(viWecTmpl("emtmpl-property",s));p.find(".input").append(s.input),"function"==typeof s.setup&&(p=s.setup(p)),o.find(`.emtmpl-${n} .${a}`).append(p),"function"==typeof s.inputType.subInit&&s.inputType.subInit(r)}s.inputType.afterInit&&s.inputType.afterInit(s.input)}}}e(".vi-ui.accordion").accordion(),l.init&&l.init(ViWec.Builder.selectedEl.get(0))}},ViWec.Blocks={_blocks:{},get:function(e){return this._blocks[e]},add:function(e,t){t.type=e,this._blocks[e]=t}},ViWec.Builder={component:{},dragMoveMutation:!1,isPreview:!1,designerMode:!1,copyStorage:"",init:function(e){var t=this;t.selectedEl=null,t.initCallback=e,t.dragElement=null,t.loadControlGroups(),t.initDragDrop(),t.initHandleBox(),t.loadContentControl(),t.loadBackgroundControl(),t.initQuickAddLayout(),t.globalEvent()},loadControlGroups:function(){let t=e("#emtmpl-components-list"),l={},n={};for(let o in t.empty(),ViWec.Components._categories){t.append(`<div class="vi-ui accordion styled fluid">
                                <div class="title active">
                                    <i class="dropdown icon"></i>
                                   ${ViWec.Components._categories[o].name}
                                </div>
                                <div class="content active" data-section="${o}">
                                    <ul></ul>
                                </div>
                            </div>`);let i=t.find('div[data-section="'+o+'"] ul'),a=ViWec.Components._categories[o].elements;for(let m in o="layout"===o?"layout":"content",a){let s=a[m],r;if(n=ViWec.Components.get(s)){if("function"==typeof n.setup)l=n.setup(),"function"==typeof n.onChange&&n.onChange(l);else{let c=n.classes||"",p=c.includes("emtmpl-pro-version"),d=p?"":`emtmpl-${o}-draggable`,u=p?"<div class='emtmpl-unlock-notice'><a target='_blank' href='https://1.envato.market/BZZv1'>Unlock this feature</a></div>":"",h=p?"<div class='dashicons dashicons-lock'></div>":"",f;l=e(`<li  data-section="${o}">
                                    ${r=`<div class="emtmpl-control-btn ${d="blocks"===s?"emtmpl-blocks-draggable":d} ${c}" data-type="${s}" data-drag-type="component">
                                            ${h} ${u} ${n.info||""}
                                            <div class="emtmpl-control-icon">
                                                <i class="emtmpl-ctrl-icon-${n.icon}"></i>
                                            </div>
                                            <div class="emtmpl-ctrl-title">${n.name}</div>`}
                                    </div></li>`)}i.append(l),"layout"===o&&e("#emtmpl-quick-add-layout .emtmpl-layout-list").append(r)}}}e(".vi-ui.accordion").accordion()},activeTab(t){e("#emtmpl-control-panel .item, #emtmpl-control-panel .tab").removeClass("active"),e(`#emtmpl-control-panel [data-tab=${t}]`).addClass("active")},clearTab(){e("#emtmpl-control-panel #emtmpl-attributes-list").empty()},loadLayoutControl:function(e){this.clearTab(),this.activeTab("editor");let t=e||this.selectedEl.data("type");ViWec.Components.render(t)},loadContentControl:function(){let t=this;e("#emtmpl-email-editor-wrapper").on("click",".emtmpl-element",function(l){t.removeFocus(),e(this).addClass("emtmpl-element-focus"),t.clearTab(),t.activeTab("editor");let n=e(this).data("type");t.selectedEl=e(this),ViWec.Components.render(n)})},loadBackgroundControl:function(){let t=this;e(".emtmpl-edit-bgcolor-btn span").on("click",function(l){t.clearTab(),t.activeTab("editor"),t.selectedEl=e("#emtmpl-email-editor-wrapper"),ViWec.Components.render("background")})},initHandleBox:function(){let t=this,l=e("#emtmpl-email-editor-wrapper");l.on("click",".emtmpl-delete-element-btn",function(l){l.preventDefault(),l.stopImmediatePropagation();let n=e(this),o=n.closest(".emtmpl-column");n.closest(".emtmpl-element").remove(),t.clearTab(),t.activeTab("components"),0===o.find(".emtmpl-element").length&&o.addClass("emtmpl-column-placeholder")}),l.on("click",".emtmpl-duplicate-element-btn",function(l){l.preventDefault(),l.stopImmediatePropagation();let n=e(this).closest(".emtmpl-element");n.after(n.clone()),t.removeFocus()}),l.on("click",".emtmpl-copy-element-btn",function(t){t.preventDefault(),t.stopImmediatePropagation();let l=e(this).closest(".emtmpl-element");l=l.prop("outerHTML"),localStorage.setItem("emtmplCopy",l)}),l.on("click",function(l){e(l.target).is(".emtmpl-layout-row")&&(t.removeFocus(),t.selectedEl=e(l.target),t.selectedEl.closest(".emtmpl-block").addClass("emtmpl-block-focus"),t.loadLayoutControl())}),l.on("click",".emtmpl-template-block",function(l){t.removeFocus(),t.selectedEl=e(this),t.selectedEl.closest(".emtmpl-block").addClass("emtmpl-block-focus"),t.loadLayoutControl()})},removeFocus:function(){e("body .emtmpl-element-focus").removeClass("emtmpl-element-focus"),e("body .emtmpl-block-focus").removeClass("emtmpl-block-focus"),this.clearTab(),this.activeTab("components")},initDragDrop:function(){let t=this;e(".emtmpl-sortable").sortable({cursor:"move",placeholder:"emtmpl-placeholder",handle:".dashicons-move",cancel:"",cursorAt:{left:40,top:18},start:function(e,t){t.helper.addClass("emtmpl-is-dragging")},stop:function(e,t){t.item.css({width:"auto",height:"auto","z-index":"unset"}),t.item.find(".emtmpl-column-sortable").columnSortAble(),t.item.removeClass("emtmpl-is-dragging"),viWecChange=!0}}),e(".emtmpl-layout-draggable").draggable({cursor:"move",cursorAt:{left:40,top:15},helper:function(){let l=e(this).data("type"),n;return t.component=ViWec.Components.get(l),viWecTmpl("emtmpl-block",{type:l,colsQty:n=t.component.cols})},start:function(e,t){t.helper.addClass("emtmpl-is-dragging")},stop:function(t,l){l.helper.handleRow(),l.helper.find(".emtmpl-column").each(function(t,l){e(l).handleColumn()}),l.helper.removeClass("emtmpl-is-dragging"),viWecChange=!0},connectToSortable:viWecEditorArea}),e(".emtmpl-content-draggable").draggable({cursor:"move",cursorAt:{left:40,top:15},helper:function(){let l=jQuery(this),n;if("component"===l.data("drag-type")){t.component=ViWec.Components.get(l.data("type"));let{type:o}=t.component,i=e('.emtmpl-element[data-type="html/recover_content"]').length;if("html/recover_content"===o&&i)return"<div></div>"}else t.component=ViWec.Blocks.get(l.data("type"));if(n=t.component.dragHtml?t.component.dragHtml:t.component.html,0===e(viWecEditorArea).children().length){let a=e(viWecTmpl("emtmpl-block",{type:"layout/grid1cols",colsQty:1}));a.handleRow().handleColumn(),a.find(".emtmpl-column-sortable").columnSortAble(),e(".emtmpl-sortable").append(a)}return`<div class='emtmpl-element' style="font-size:15px;border-radius: 0; overflow: hidden;line-height: 22px;" data-type="${l.data("type")}">${n}</div>`},start:function(e,t){t.helper.addClass("emtmpl-is-dragging")},drag:function(e,t){},stop:function(t,l){if(!l.helper.hasClass("emtmpl-element")){l.helper.remove();return}l.helper.removeClass("emtmpl-is-dragging"),l.helper.handleElement(),l.helper.css("z-index",""),l.helper.click(),viWecChange=!0,e("#emtmpl-element-search input.emtmpl-search").val("").trigger("keyup"),e("#emtmpl-attributes-list input").trigger("keyup")},connectToSortable:".emtmpl-column-sortable"}),e(".emtmpl-blocks-draggable").draggable({cursor:"move",helper(){let t="No block was found",l="";if(viWecParams.templateBlocks.length){let{data:n}=viWecParams.templateBlocks[0];l=viWecParams.templateBlocks[0].id,t=ViWec.renderRows(n.rows,!1)}let o=e(`<div class="emtmpl-block"><div class="emtmpl-template-block" data-type="blocks" data-block="${l}"></div></div>`);return o.find(".emtmpl-template-block").append(t),o},start(e,t){t.helper.addClass("emtmpl-is-dragging")},stop(e,t){t.helper.handleRow(),t.helper.removeClass("emtmpl-is-dragging"),viWecChange=!0,t.helper.find(".emtmpl-template-block").trigger("click")},connectToSortable:viWecEditorArea})},initQuickAddLayout:function(){e("#emtmpl-quick-add-layout .emtmpl-control-btn").on("click",function(){let t=e(this).data("type"),l,n;self.component=ViWec.Components.get(t),(n=e(viWecTmpl("emtmpl-block",{type:t,colsQty:l=self.component.cols}))).handleRow().handleColumn(),n.find(".emtmpl-column-sortable").columnSortAble(),e(".emtmpl-sortable").append(n),e(this).closest(".emtmpl-layout-list").toggle()})},globalEvent:function(){let t=this;e("body").on("click",function(l){(e(l.target).is("#wpwrap")||e(l.target).is("#emtmpl-email-editor-wrapper"))&&(t.removeFocus(),e(".emtmpl-layout-list").hide())}).on("keyup",function(t){46===t.which&&(e(t.target).closest("#emtmpl-control-panel").length||(e(".emtmpl-element-focus .emtmpl-delete-element-btn").trigger("click"),e(".emtmpl-block-focus .emtmpl-delete-row-btn").trigger("click")))})}},ViWec.StyleManager={setStyle:function(e,t,l,n){return e.css(t,l+n)},_getCssStyle:function(e,t,l=null){let n=l||t.key;if("width"===n&&t.unit&&"%"===t.unit){let o=parseInt(e.css("width")),i=parseInt(e.parent().css("width"));if(i>0)return Math.round(o/i*100)+"%"}else{let a=e.get(0),m;if(a)return a.style&&a.style.length>0&&a.style[n]?m=a.style[n]:a.currentStyle?m=a.currentStyle[n]:window.getComputedStyle&&(m=document.defaultView.getDefaultComputedStyle?document.defaultView.getDefaultComputedStyle(a,null).getPropertyValue(n):window.getComputedStyle(a,null).getPropertyValue(n)),"transparent"===m&&(m=""),m}},getStyle:function(e,t,l){return this._getCssStyle(e,t,l)}}});